

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Loom: Installation &amp; Deployment Guide &mdash; Loom 0.7.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Loom 0.7.0 documentation" href="index.html"/>
        <link rel="next" title="Loom How-To, FAQ and Troubleshooting Guide" href="loom_trbs_faq.html"/>
        <link rel="prev" title="Welcome to Loom’s documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Loom
          

          
            
            <img src="_static/loom.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.7.0 (Beta-1-Dev)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Loom Deployment Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-loom-deployment">Introduction to Loom Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loom-deployment-models">Loom: Deployment Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#on-premise-deployment">On Premise Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#public-cloud-deployment">Public Cloud Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hybrid-cloud-deployment">Hybrid Cloud Deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-prerequisites">Installation Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#planning-preparation">Planning &amp; Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-requirements">System Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verify-dependencies">Verify Dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bootstrapping-loom">Bootstrapping Loom</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#on-boarding-multi-tier-applications-on-loom">On-boarding multi-tier Applications on Loom</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loom-cloud-deployment">Loom: Cloud Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#azure-deployment-guide">Azure Deployment Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#azure-configuration">Azure Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loom-infrastructure-setup">Loom Infrastructure Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ha-cluster-deployment">HA / Cluster Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security-access-control">Security &amp; Access Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous-setups-and-azure-tuning-for-loom">Miscellaneous Setups and Azure Tuning for Loom</a></li>
<li class="toctree-l4"><a class="reference internal" href="#azure-deployment-troubleshooting-guide">Azure Deployment Troubleshooting Guide</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#oracle-deployment">Oracle Deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loom-on-premise-deployment">Loom On-Premise Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loom-hybrid-deployment">Loom Hybrid Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loom-de-installation-procedure">Loom: De-installation Procedure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#service-shutdown">Service Shutdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="#de-installing-component-a">De-installing component A</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-loom">Upgrading Loom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cleanup-scripts">Cleanup Scripts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-troubleshooting-guide">Deployment Troubleshooting Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#resolving-basic-loom-deployment-issues">Resolving Basic Loom deployment issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-begin-loom-deployment-troubleshooting">How to begin Loom deployment troubleshooting?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-to-look-for-more-details-is-a-pod-is-not-healthy">Where to look for more details is a Pod is not healthy?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-determine-which-software-version-is-deployed-for-each-pod">How to determine which software version is deployed for each pod?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#looking-for-dependency-health">Looking for Dependency Health</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loom-tenant-creation-issues">Loom Tenant Creation Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#content-source-added-but-cannot-view-data-in-the-loom-application-dashboard">Content source added but cannot view data in the Loom Application Dashboard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kafka-does-not-produce-or-consume-any-data-how-to-fix-it">Kafka does not produce or consume any data, how to fix it?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#loom-service-patching">Loom Service Patching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-loom-networking-issues">Troubleshooting Loom networking issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-plane-issues">Control plane Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-plane-issues">Data plane Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#message-flow-between-data-plane-control-plane">Message flow between data plane/control plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tenant-deployment-issues">Tenant deployment issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#security-issues">Security Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues-related-to-loom-logs-access-logs">Issues related to Loom logs, Access logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#moving-to-different-availability-set">Moving to different availability set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues-related-to-sluggish-loom-application-response">Issues related to sluggish Loom Application response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues-related-to-loom-metrics">Issues related to Loom Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues-related-to-system-load">Issues related to System Load</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-faq">Deployment FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#question-a-related-to-any-type-of-loom-deployment">Question A: Related to any type of Loom deployment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="loom_trbs_faq.html">Loom Troubleshooting Guide &amp; FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcdmp_devdocs.html">Platform SDK API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="devx.html">DevX User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcdmp_docx_res.html">DocX Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Loom</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Loom: Installation &amp; Deployment Guide</li>
    
    
    <p>
        <a href="https://stash.veritas.com/projects/MCDMP/repos/pform-docs/browse/source/loom_installation_guide.rst" class="fa fa-bitbucket" aria-hidden="true">&nbsp; Edit on Bitbucket</a>
    
          <a href="../latex/loom_installation_guide.pdf" class="fa"style="float:right;">Download PDF</a>
    
    </p> 
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="loom-installation-deployment-guide">
<span id="installation-guide-rst"></span><h1>Loom: Installation &amp; Deployment Guide<a class="headerlink" href="#loom-installation-deployment-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction-to-loom-deployment" id="id9">Introduction to Loom Deployment</a></li>
<li><a class="reference internal" href="#loom-deployment-models" id="id10">Loom: Deployment Models</a><ul>
<li><a class="reference internal" href="#on-premise-deployment" id="id11">On Premise Deployment</a></li>
<li><a class="reference internal" href="#public-cloud-deployment" id="id12">Public Cloud Deployment</a></li>
<li><a class="reference internal" href="#hybrid-cloud-deployment" id="id13">Hybrid Cloud Deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-prerequisites" id="id14">Installation Prerequisites</a><ul>
<li><a class="reference internal" href="#planning-preparation" id="id15">Planning &amp; Preparation</a></li>
<li><a class="reference internal" href="#system-requirements" id="id16">System Requirements</a></li>
<li><a class="reference internal" href="#verify-dependencies" id="id17">Verify Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bootstrapping-loom" id="id18">Bootstrapping Loom</a><ul>
<li><a class="reference internal" href="#on-boarding-multi-tier-applications-on-loom" id="id19">On-boarding multi-tier Applications on Loom</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loom-cloud-deployment" id="id20">Loom: Cloud Deployment</a><ul>
<li><a class="reference internal" href="#azure-deployment-guide" id="id21">Azure Deployment Guide</a></li>
<li><a class="reference internal" href="#overview" id="id22">Overview</a></li>
<li><a class="reference internal" href="#oracle-deployment" id="id23">Oracle Deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loom-on-premise-deployment" id="id24">Loom On-Premise Deployment</a></li>
<li><a class="reference internal" href="#loom-hybrid-deployment" id="id25">Loom Hybrid Deployment</a></li>
<li><a class="reference internal" href="#loom-de-installation-procedure" id="id26">Loom: De-installation Procedure</a><ul>
<li><a class="reference internal" href="#service-shutdown" id="id27">Service Shutdown</a></li>
<li><a class="reference internal" href="#de-installing-component-a" id="id28">De-installing component A</a></li>
<li><a class="reference internal" href="#upgrading-loom" id="id29">Upgrading Loom</a></li>
<li><a class="reference internal" href="#cleanup-scripts" id="id30">Cleanup Scripts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deployment-troubleshooting-guide" id="id31">Deployment Troubleshooting Guide</a><ul>
<li><a class="reference internal" href="#resolving-basic-loom-deployment-issues" id="id32">Resolving Basic Loom deployment issues</a></li>
<li><a class="reference internal" href="#loom-service-patching" id="id33">Loom Service Patching</a></li>
<li><a class="reference internal" href="#troubleshooting-loom-networking-issues" id="id34">Troubleshooting Loom networking issues</a></li>
<li><a class="reference internal" href="#control-plane-issues" id="id35">Control plane Issues</a></li>
<li><a class="reference internal" href="#data-plane-issues" id="id36">Data plane Issues</a></li>
<li><a class="reference internal" href="#message-flow-between-data-plane-control-plane" id="id37">Message flow between data plane/control plane</a></li>
<li><a class="reference internal" href="#tenant-deployment-issues" id="id38">Tenant deployment issues</a></li>
<li><a class="reference internal" href="#security-issues" id="id39">Security Issues</a></li>
<li><a class="reference internal" href="#issues-related-to-loom-logs-access-logs" id="id40">Issues related to Loom logs, Access logs</a></li>
<li><a class="reference internal" href="#moving-to-different-availability-set" id="id41">Moving to different availability set</a></li>
<li><a class="reference internal" href="#issues-related-to-sluggish-loom-application-response" id="id42">Issues related to sluggish Loom Application response</a></li>
<li><a class="reference internal" href="#issues-related-to-loom-metrics" id="id43">Issues related to Loom Metrics</a></li>
<li><a class="reference internal" href="#issues-related-to-system-load" id="id44">Issues related to System Load</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deployment-faq" id="id45">Deployment FAQ</a><ul>
<li><a class="reference internal" href="#question-a-related-to-any-type-of-loom-deployment" id="id46">Question A: Related to any type of Loom deployment</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction-to-loom-deployment">
<h2><a class="toc-backref" href="#id9">Introduction to Loom Deployment</a><a class="headerlink" href="#introduction-to-loom-deployment" title="Permalink to this headline">¶</a></h2>
<p>This section will cover introduction of Loom Installation and Deployment Methodology as seen by an external user. A user refers to DevOps Admin or Enterprise Admin in charge of deploying Loom Platform.</p>
<p>It will also cover how this guide is organized.  After introduction section, there is a section on Deployment models describing different ways in which Loom can be deployed for use in an enterprise. Next, it will cover deployment and install process for each method in detail. The last section is about general troubleshooting and FAQ for overall Loom Platform deployment and install process.  In addition to the generic troubleshooting section, there will be per deployment model specific troubleshooting and FAQ guides that will cover topics specific to a particular deployment model.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">This is a <strong>PLACEHOLDER</strong> content.</p>
</div>
<p>Please note, this is placeholder text according to current outline.  We will refine the content in subsequent iterations as UK folks plug in the specifics for say Cloud based deployment.</p>
<hr class="docutils" />
</div>
<div class="section" id="loom-deployment-models">
<span id="ing-dep-models-mcdmp-rst"></span><h2><a class="toc-backref" href="#id10">Loom: Deployment Models</a><a class="headerlink" href="#loom-deployment-models" title="Permalink to this headline">¶</a></h2>
<p>Loom can be deployed as per the enterprise needs either on premise, or in a private cloud, or public cloud, or a hybrid environment.  The platform offers flexible deployment on-premise either on bare metal servers or virtual machines.</p>
<p>Other details TBD in consultation with Platform team.</p>
<div class="section" id="on-premise-deployment">
<h3><a class="toc-backref" href="#id11">On Premise Deployment</a><a class="headerlink" href="#on-premise-deployment" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Bare Metal Server</li>
<li>Virtual Machine</li>
</ul>
</div>
<div class="section" id="public-cloud-deployment">
<h3><a class="toc-backref" href="#id12">Public Cloud Deployment</a><a class="headerlink" href="#public-cloud-deployment" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Azure</li>
<li>Oracle</li>
<li>AWS</li>
<li>Others</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Cloud-Provider</strong></td>
<td>Deployment Guide Reference</td>
</tr>
<tr class="row-even"><td><strong>Azure</strong></td>
<td>Refer to <a class="reference internal" href="#file-cloud-azure-dep-guide"><span class="std std-ref">Azure Deployment Guide</span></a></td>
</tr>
<tr class="row-odd"><td><strong>Oracle</strong></td>
<td>TBD</td>
</tr>
<tr class="row-even"><td><strong>AWS</strong></td>
<td>TBD</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hybrid-cloud-deployment">
<h3><a class="toc-backref" href="#id13">Hybrid Cloud Deployment</a><a class="headerlink" href="#hybrid-cloud-deployment" title="Permalink to this headline">¶</a></h3>
<p>Loom can also be deployed as a hybrid cloud. The first version of the product does not support this model.  This section will be updated in subsequent releases of Loom.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="installation-prerequisites">
<h2><a class="toc-backref" href="#id14">Installation Prerequisites</a><a class="headerlink" href="#installation-prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This section will contain the software required to deploy Loom. This is a generic section not specific to any deployment model. Deployment Model specific pre-requisites will be covered in the respective sections.</p>
<p>For e.g., to bring up the control plane what are the software and setup needed.
See details here: <a class="reference external" href="https://jira.community.veritas.com/browse/IMP-964?jql=project%20%3D%20IMP%20AND%20status%20%3D%20Open%20AND%20text%20~%20%22Document%22">Issue in Jira (IMP-964)</a></p>
<div class="section" id="planning-preparation">
<h3><a class="toc-backref" href="#id15">Planning &amp; Preparation</a><a class="headerlink" href="#planning-preparation" title="Permalink to this headline">¶</a></h3>
<p>Placeholder Outline of Planning &amp; Preparation Section</p>
</div>
<div class="section" id="system-requirements">
<h3><a class="toc-backref" href="#id16">System Requirements</a><a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h3>
<p>For latest Loom System Requirements, refer to <a class="reference external" href="http://10.67.141.149/shaloo/aggr/pform-ugdocs/html/loom_getting_started_guide.html#content-platform-tech-specs" title="(in Loom v0.7.0 (Beta-1-Dev))"><span class="xref std std-ref">Platform Technical Specifications Section</span></a>.</p>
</div>
<div class="section" id="verify-dependencies">
<h3><a class="toc-backref" href="#id17">Verify Dependencies</a><a class="headerlink" href="#verify-dependencies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Loom Deployment requires several Open Source Software components.</li>
<li>See the <a class="reference internal" href="ing/common/loom_all_dep_list.html#ing-loom-all-dep-list"><span class="std std-ref">Loom Software Dependency Master List</span></a> utilized by Loom Platform and Loom Applications.</li>
</ul>
<hr class="docutils" />
</div>
</div>
<div class="section" id="bootstrapping-loom">
<h2><a class="toc-backref" href="#id18">Bootstrapping Loom</a><a class="headerlink" href="#bootstrapping-loom" title="Permalink to this headline">¶</a></h2>
<p>In the previous sections of this Installation Guide, we covered various options available to an enterprise for Loom Platform deployment and pre-requisites for the same.</p>
<p>This section explains how Loom Platform itself is bootstrapped in various deployment models. Besides that, it lists workflows on how various Loom components and services are instantiated. Next, it covers how to on board an end-to-end multi-tiered application on Loom Platform.</p>
<p>At a conceptual level, there are 4 stages of Loom Platform deployment that need to be completed by the Platform, Partner and Tenant Admin before the end user can begin using various features offered by Platform and its Apps such as Visibility and Classification.</p>
<ul class="simple">
<li><strong>STAGE1:</strong> As a first step, the Platform and its components need to be downloaded and initiated (for an on-premise deployment). In case of a Cloud based deployment, this first step is usually carried out either by Veritas or one of its Partners. During this phase, infrastructure components including persistent databases, micro-services comprising of the Platform and Control Plane constituents are instantiated.</li>
<li><strong>STAGE2:</strong> Next, the Data Planes need to be setup for every tenant or customer organization and user accounts created in the context of each tenant.  This can be done only by tenant Admin, so Loom Platform deployment Admin must setup Partner Admin accounts (if a Partner such as Cloud Provider is hosting Loom Platform) or create respective Tenant Admin to carry out Data Plane orchestration. The Data Plane setup requires credentials that are internal to the Tenant organization - for e.g., Azure access credentials, AWS customer credentials etc. Besides this, the Tenant Admin also needs to create user accounts and assign roles such as Storage/IT Admin, end users, and others. The Platform Admin or the Partner Admin is also required to define the enterprise wide Data Access policies to enable data data scans, audits and tracking for various enterprise data assets.</li>
<li><strong>STAGE3:</strong> After, User account definition and Data Plane configuration, the Tenant Admin or assigned user with Storage/IT Admin role can plug in different data sources within the organization that need to be analyzed and scanned for gaining data insights and visibility. This may require access to various filers, cloud storage and other data sources within the enterprise. (Question:  Does that mean that there may be <strong>unknown</strong> data sources that are being managed and expenses made for storage that may not even be known to an enterprise? There is no auto detection of filers / storage sources in Loom Platform - right?) The</li>
<li><strong>STAGE4:</strong> Once users are defined, policies and data sources configured, end users can begin using the Platform and access Platform Apps that are deployed in their context.  Note, not all Platform Apps may be visible to all tenant accounts.  The default ones accessible to all include Platform UI App, Visibility &amp; Classification App. Also, not all user roles may be allowed to view all kinds of enterprise information. For e.g., only a certain kinds of privileged users may have access to all PII stored within the enterprise.  Loom Platform can scan and tag all data provided it to via policies, data sources and other filters and classify information based on filters and tags.</li>
</ul>
<p>Content-TBD
Add a high level picture with 4 blobs and arrows pointing from first stage to the fourth one.
Jason-help-needed!</p>
<p>Figure below goes to the next level of detail describing Loom Platform bootstrapping at a conceptual level.  Different color highlight different stages.  You can see various Platform Admin roles and personas that carry out each of these steps to ensure Platform services are up and running for end users to begin interacting with it.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/mcdmp_bootstrap.png"><img alt="Bootstrapping Loom" src="_images/mcdmp_bootstrap.png" style="width: 1069.5px; height: 570.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Stages of Loom Platform Bootstrapping Process</span></p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>This is a <strong>DOC-CONTRIB</strong> Request</p>
<p>This section contains placeholder for content that requires shared contribution by Loom dev / owner personnel. As part of Loom Deployment section, we need to add the step by step instructions on how an end user would actually deploy Loom.  Use the following JIRA EPIC pointers for more information and user stories regarding the same.</p>
<ul class="last simple">
<li>User Onboarding section: Refer to <a class="reference external" href="http://jira.community.veritas.com/browse/IMP-887/">Jira 887</a></li>
<li>Control Plane Bootstrapping: Refer to <a class="reference external" href="http://jira.community.veritas.com/browse/IMP-966/">Jira 966</a></li>
<li>How to deploy a data plane (on-premise): Refer to <a class="reference external" href="http://jira.community.veritas.com/browse/IMP-993/">Jira 993</a></li>
<li>How to register a deployed data plane with control plane: Refer to <a class="reference external" href="http://jira.community.veritas.com/browse/IMP-995/">Jira 995</a></li>
</ul>
</div>
<div class="section" id="on-boarding-multi-tier-applications-on-loom">
<h3><a class="toc-backref" href="#id19">On-boarding multi-tier Applications on Loom</a><a class="headerlink" href="#on-boarding-multi-tier-applications-on-loom" title="Permalink to this headline">¶</a></h3>
<p>Describe how a multi-tier application can on-board Loom Platform.  This includes third party applications such as ??? (find list from Platform team). What about in-built apps (if any)? Choosing and installing via Marketplace?</p>
<ul class="simple">
<li>Generic 3 tier apps</li>
<li>Specific App – from Marketplace</li>
<li>3rd party apps</li>
<li>SaaS Hosted Apps</li>
</ul>
<hr class="docutils" />
</div>
</div>
<div class="section" id="loom-cloud-deployment">
<h2><a class="toc-backref" href="#id20">Loom: Cloud Deployment</a><a class="headerlink" href="#loom-cloud-deployment" title="Permalink to this headline">¶</a></h2>
<p><strong>Introduction</strong></p>
<p>Veritas Loom Cloud Deployment Model is designed to work on any public cloud provider such as Microsoft Azure, Amazon AWS, Google GCP, Oracle Cloud, IBM Cloud and other cloud providers.  In the very first release, Loom is available as a pre-deployed service hosted on Microsoft Azure.  In future releases, Veritas Partners will be able to deploy Loom themselves on a cloud of their choice.</p>
<p><strong>Overview</strong></p>
<p>The following figure gives a high level overview of a typical Loom Cloud deployment.  It comprises of a starter VM that helps to jump-start a Kubernetes cluster with requisite Loom services that are needed to bring up various Loom capabilities
such as managing Loom Users, managing connectivity to various enterprise content repositories, administration of Loom Deployment, managing data classification jobs and their status, tracking data accesses, setting up of enterprise specific data policies and more.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To be updated</p>
<p>This section will contain image / diagram / figures explaining how a Loom Cloud deployment is done, various components and where each is deployed.  How the enterprise / MSP can set up Loom on cloud, which components to interact with and more.
Looking up to Branislav / Adam to provide a high level sketch that can be added here.</p>
<p class="last">Note, this diagram will be generic to any cloud deployment.  Specific cloud deployments will be covered in individual deployment guides dedicated to each supported cloud provider.</p>
</div>
<hr class="docutils" />
<div class="section" id="azure-deployment-guide">
<span id="file-cloud-azure-dep-guide"></span><h3><a class="toc-backref" href="#id21">Azure Deployment Guide</a><a class="headerlink" href="#azure-deployment-guide" title="Permalink to this headline">¶</a></h3>
<p>This guide covers the design and implementation details of deploying Veritas Loom on Microsoft Azure cloud. It is intended for DevOps personnel that are entrusted with deploying Loom for Veritas or its Partner Enterprise. The very first release of Veritas Loom is <em>only</em> available as a SaaS deployment hosted on Microsoft Azure and managed by Veritas.  In future, Veritas Partners can bring up their own Loom SaaS deployment on Microsoft Azure and onboard customer organizations. For deploying Loom on other cloud providers, refer to Cloud Provider specific Loom deployment Guide.</p>
<p>The following sections cover Loom deployment on Microsoft Azure and how to bring up all the services to ensure deployment status is healthy and ready for further usage.  For details on how to use Loom, refer to the Loom User Getting Started Guide.</p>
<p>Loom Azure Deployment comprises of four key areas:  Cloud Configuration, Loom Infrastructure Setup, High Availability(HA) and Cluster Deployment, Security and Access Control and other Azure specific deployment details. The last section of this guide addresses some of the common issues faced during Loom deployment on Microsoft Azure and troubleshooting tips.</p>
<hr class="docutils" />
</div>
<div class="section" id="overview">
<span id="content-azure-dep-oview"></span><h3><a class="toc-backref" href="#id22">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The figure below captures a very high level diagram of a typical Loom SaaS deployment on Microsoft Azure based cloud infrastructure.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>The overview section is under the process of refinement / review and updates.</p>
<p class="last">The figure below is based on the one provided by Engineering DevOps on Confluence Page titled <a class="reference external" href="https://confluence.community.veritas.com/x/PjPFBw">Azure Topology</a>. The internal confluence reference will be eliminated from the final draft of this guide, once the details are crystallized and ready for sharing with external customers.</p>
</div>
<hr class="docutils" />
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/azure-dep-fig.png"><img alt="LoomAzureDep" src="_images/azure-dep-fig.png" style="width: 1896.0px; height: 1057.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Loom (Alpha2) Control Plane Deployment Topology on Microsoft Azure</span></p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">The figure below shows the Loom Azure SaaS Data Plane Deployment Details.  Parking it here for the next refresh cycle of the Loom Deployment Guide.</p>
</div>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/azure-dep-dp-fig.png"><img alt="LoomAzureDPDep" src="_images/azure-dep-dp-fig.png" style="width: 782.0px; height: 441.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Loom (Alpha2) Data Plane Deployment Topology on Microsoft Azure</span></p>
</div>
<hr class="docutils" />
<div class="section" id="azure-configuration">
<h4>Azure Configuration<a class="headerlink" href="#azure-configuration" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Identification of region/s</p>
<ul>
<li><p class="first">Number of Availability set required and define how different component uses it.</p>
<blockquote>
<div><ul class="simple">
<li>Rack id : will this be used in no SQL Engines?</li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p class="first">Identification of Azure account</p>
</li>
<li><p class="first">Identification of regions to be deployed</p>
</li>
<li><p class="first">Identification of domain and sub-domain name(if required)</p>
<ul class="simple">
<li>DNS</li>
<li>Static IP required?</li>
</ul>
</li>
<li><p class="first">VPN connection across regions</p>
</li>
<li><p class="first">Deployment Topology</p>
<ul class="simple">
<li>Azure | Oracle</li>
</ul>
</li>
<li><p class="first">General</p>
<ul>
<li><p class="first">Network connectivity</p>
<blockquote>
<div><ul>
<li><p class="first">Subnets</p>
<blockquote>
<div><ul class="simple">
<li>Database</li>
<li>DMZ zone</li>
<li>CP/DP communication</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">VNET peering</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Traffic flow</p>
</li>
<li><p class="first">Bandwidth/latency</p>
</li>
<li><p class="first">Bastion server - Management server</p>
</li>
<li><p class="first">WAF for all external network calls</p>
</li>
</ul>
</li>
<li><p class="first">Network flow diagram and port access across system boundaries</p>
<ul class="simple">
<li>UI accessing LB</li>
<li>Communication from CP to DP, Ports opened</li>
<li>Communication from DP to CP, Ports opened</li>
<li>Network flow: tenant isolation depicted diagram</li>
<li>IPSec or HTTPS/SSL from CP to DP</li>
</ul>
</li>
<li><p class="first">Firewall/NAT services in front of load balancer</p>
<ul class="simple">
<li>Learning, Blocking, slow connection</li>
</ul>
</li>
<li><p class="first">Front end load balancer : Azure| oracle load balancer</p>
<ul class="simple">
<li>SSL offloading  - Terminate at load balancer?</li>
<li>Data at motion security consideration has to be finalized and updated</li>
<li>NGINX  HA</li>
</ul>
</li>
</ol>
<hr class="docutils" />
</div>
<div class="section" id="loom-infrastructure-setup">
<h4>Loom Infrastructure Setup<a class="headerlink" href="#loom-infrastructure-setup" title="Permalink to this headline">¶</a></h4>
<p>Following is the suggested outline for this sub-section.  Information related to these topics need to be fleshed out for Loom Infrastructure Setup in the context of Azure deployment.</p>
<div class="section" id="deploying-infra-services">
<h5>Deploying infra services<a class="headerlink" href="#deploying-infra-services" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>DMZ zone<ul>
<li>Application gateway</li>
<li>Firewall<ul>
<li>which firewall and its configuration management</li>
<li>Different Security group</li>
<li>Different subnet</li>
</ul>
</li>
<li>Management<ul>
<li>Bastion server<ul>
<li>Different Security Group</li>
<li>Different subnet</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Infra components<ul>
<li>Cassandra<ul>
<li>Partitioning strategy</li>
<li>Adding a node</li>
<li>Decommissioning node</li>
<li>Re-balancing</li>
<li>Database backup/recovery</li>
<li>version update</li>
</ul>
</li>
<li>Elastic search<ul>
<li>Master and data node deployment</li>
<li>Add a node</li>
<li>De-commission node</li>
<li>Identifying bottle necks, Split brain, Data loss, reconciliation</li>
<li>Version update</li>
</ul>
</li>
<li>Postgres<ul>
<li>Master/Slave</li>
<li>Virtual IP/DNS<ul>
<li>Switching between Master/slave</li>
</ul>
</li>
<li>Capacity planning with data growth</li>
<li>version update</li>
</ul>
</li>
<li>K8 cluster<ul>
<li>Integration with Veritas LDAP user ?</li>
<li>Namespace design</li>
<li>Across region deployment (if required)??<ul>
<li>VPC peering kind of in azure</li>
<li>Availability set</li>
</ul>
</li>
</ul>
</li>
<li>Kafka<ul>
<li>Ports opened</li>
<li>Partition</li>
<li>Number of Brokers<ul>
<li>Addition</li>
<li>Decommission</li>
</ul>
</li>
</ul>
</li>
<li>RabbitMQ<ul>
<li>Federation required across region(if required)</li>
<li>SSL</li>
</ul>
</li>
<li>System crashes<ul>
<li>Handling of VM/EC2 crashes<ul>
<li>Volume strategy</li>
<li>recovery</li>
</ul>
</li>
<li>Corruption of volumes/recovery mechanism</li>
</ul>
</li>
<li>DR/BR<ul>
<li>Database backup<ul>
<li>Incremental</li>
</ul>
</li>
<li>Geographic Disaster</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr class="docutils" />
</div>
</div>
<div class="section" id="ha-cluster-deployment">
<h4>HA / Cluster Deployment<a class="headerlink" href="#ha-cluster-deployment" title="Permalink to this headline">¶</a></h4>
<p>This is the suggested outline for HA /Cluster Deployment section in case of Azure Deployment.</p>
<ul class="simple">
<li>Define availability set</li>
<li>Define number of nodes that will be supported by default and adding incremental node</li>
<li>VPN connection across regions<ul>
<li>IPSec or HTTPS/SSL from CP to DP</li>
<li>Artifactory server access to upgrade</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</div>
<div class="section" id="security-access-control">
<h4>Security &amp; Access Control<a class="headerlink" href="#security-access-control" title="Permalink to this headline">¶</a></h4>
<p>Here is a recommended outline for Security and Access Control Setup in Azure Deployment scenario of MCDM Platform (Loom). We need to flesh out this section along with diagrams / figures.</p>
<ul>
<li><p class="first">Access control to deployed system</p>
<ul class="simple">
<li>Via Bastion server</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Least privileges</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Key management and rotation policy</li>
<li>Audit log</li>
</ul>
</li>
<li><p class="first">Security</p>
<ul class="simple">
<li>Handle - when security is comprised<ul>
<li>Patch update/services</li>
<li>recovery</li>
</ul>
</li>
<li>Intrusion detection system - Firewall<ul>
<li>SQL injection prevention, XSS attacks</li>
<li>WAF ?</li>
<li>Define golden configuration</li>
</ul>
</li>
<li>OS hardening<ul>
<li>Docker user and access control<ul>
<li>Restriction File access, encrypted volume</li>
</ul>
</li>
<li>Host firewall</li>
</ul>
</li>
<li>Network traffic<ul>
<li>Network ACL, Security groups, Routing table on Azure/oracle/AWS<ul>
<li>Golden configuration</li>
</ul>
</li>
<li>List all ports that are white listed</li>
</ul>
</li>
<li>Auditing/Incident notification<ul>
<li>Integration with messaging/email</li>
</ul>
</li>
<li>Key management - Data at motion, Data at rest<ul>
<li>Encryption</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
</div>
<div class="section" id="miscellaneous-setups-and-azure-tuning-for-loom">
<h4>Miscellaneous Setups and Azure Tuning for Loom<a class="headerlink" href="#miscellaneous-setups-and-azure-tuning-for-loom" title="Permalink to this headline">¶</a></h4>
<p>This section covers other miscellaneous configuration settings and tuning required to ensure that Veritas Loom is successfully up and running normally in Microsoft Azure Cloud.  Need help from Adam and Branislav to populate this section.
~</p>
<hr class="docutils" />
</div>
<div class="section" id="azure-deployment-troubleshooting-guide">
<h4>Azure Deployment Troubleshooting Guide<a class="headerlink" href="#azure-deployment-troubleshooting-guide" title="Permalink to this headline">¶</a></h4>
<p>Loom Deployment on Microsoft Azure Cloud might face certain deployment issues. This guide contains some of the frequently encountered issues and fixes, tips on how to solve them to attain a healthy Loom Deployment status.</p>
<p>TBD - Need help from Branislav, Dinesh, Adam and others to populate this section.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="oracle-deployment">
<h3><a class="toc-backref" href="#id23">Oracle Deployment</a><a class="headerlink" href="#oracle-deployment" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="loom-on-premise-deployment">
<span id="ing-com-on-prem-install"></span><h2><a class="toc-backref" href="#id24">Loom On-Premise Deployment</a><a class="headerlink" href="#loom-on-premise-deployment" title="Permalink to this headline">¶</a></h2>
<p>This is not supported in the initial release.</p>
<p>This guide is a placeholder for now.  It will be covered once the functionality is added in Loom platform.</p>
<hr class="docutils" />
</div>
<div class="section" id="loom-hybrid-deployment">
<h2><a class="toc-backref" href="#id25">Loom Hybrid Deployment</a><a class="headerlink" href="#loom-hybrid-deployment" title="Permalink to this headline">¶</a></h2>
<p>This mode of deployment is not supported in the initial release of Loom.</p>
<p>This Guide is a placeholder until this functionality is supported in Loom.</p>
<hr class="docutils" />
</div>
<div class="section" id="loom-de-installation-procedure">
<h2><a class="toc-backref" href="#id26">Loom: De-installation Procedure</a><a class="headerlink" href="#loom-de-installation-procedure" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
<div class="section" id="service-shutdown">
<h3><a class="toc-backref" href="#id27">Service Shutdown</a><a class="headerlink" href="#service-shutdown" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="de-installing-component-a">
<h3><a class="toc-backref" href="#id28">De-installing component A</a><a class="headerlink" href="#de-installing-component-a" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="upgrading-loom">
<h3><a class="toc-backref" href="#id29">Upgrading Loom</a><a class="headerlink" href="#upgrading-loom" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="cleanup-scripts">
<h3><a class="toc-backref" href="#id30">Cleanup Scripts</a><a class="headerlink" href="#cleanup-scripts" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="deployment-troubleshooting-guide">
<span id="ing-com-dep-trbs"></span><h2><a class="toc-backref" href="#id31">Deployment Troubleshooting Guide</a><a class="headerlink" href="#deployment-troubleshooting-guide" title="Permalink to this headline">¶</a></h2>
<p>This guide lists down some of the key issues faced during Loom Deployment and provides useful tips and insights on how to address Loom Deployment issues.  The audience for this guide are the Loom Platform Admins, Loom Application developers and others trying to deploy Loom and its components.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The following content is primarily focused on Loom Deployment in SaaS Model on Microsoft Azure Cloud. This is the only supported deployment as of Loom Alpha releases.</p>
<p class="last">In future, this guide may also contain information related to other kinds of Loom Deployment.  For details on different kinds of Loom Deployments see <a class="reference internal" href="#ing-dep-models-mcdmp-rst"><span class="std std-ref">Loom: Deployment Models</span></a>.</p>
</div>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><a class="reference internal" href="#resolving-basic-loom-deployment-issues" id="id47">Resolving Basic Loom deployment issues</a></li>
<li><a class="reference internal" href="#loom-service-patching" id="id48">Loom Service Patching</a></li>
<li><a class="reference internal" href="#troubleshooting-loom-networking-issues" id="id49">Troubleshooting Loom networking issues</a></li>
<li><a class="reference internal" href="#control-plane-issues" id="id50">Control plane Issues</a></li>
<li><a class="reference internal" href="#data-plane-issues" id="id51">Data plane Issues</a></li>
<li><a class="reference internal" href="#message-flow-between-data-plane-control-plane" id="id52">Message flow between data plane/control plane</a></li>
<li><a class="reference internal" href="#tenant-deployment-issues" id="id53">Tenant deployment issues</a></li>
<li><a class="reference internal" href="#security-issues" id="id54">Security Issues</a></li>
<li><a class="reference internal" href="#issues-related-to-loom-logs-access-logs" id="id55">Issues related to Loom logs, Access logs</a></li>
<li><a class="reference internal" href="#moving-to-different-availability-set" id="id56">Moving to different availability set</a></li>
<li><a class="reference internal" href="#issues-related-to-sluggish-loom-application-response" id="id57">Issues related to sluggish Loom Application response</a></li>
<li><a class="reference internal" href="#issues-related-to-loom-metrics" id="id58">Issues related to Loom Metrics</a></li>
<li><a class="reference internal" href="#issues-related-to-system-load" id="id59">Issues related to System Load</a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="resolving-basic-loom-deployment-issues">
<h3><a class="toc-backref" href="#id47">Resolving Basic Loom deployment issues</a><a class="headerlink" href="#resolving-basic-loom-deployment-issues" title="Permalink to this headline">¶</a></h3>
<p>This section lists some of the Loom deployment related issues faced in early builds, alpha1, alpha2 and how to resolve the same.</p>
<div class="section" id="how-to-begin-loom-deployment-troubleshooting">
<h4>How to begin Loom deployment troubleshooting?<a class="headerlink" href="#how-to-begin-loom-deployment-troubleshooting" title="Permalink to this headline">¶</a></h4>
<p>The first step is to check the status of the <a class="reference external" href="http://10.67.141.149/shaloo/aggr/pform-ugdocs/html/mcdmp_concepts.html#def-term-planes" title="(in Loom v0.7.0 (Beta-1-Dev))"><span>Control And Data Planes</span></a> in a Loom deployment.</p>
<p>Following figures show all the pods in healthy state.  The first figure refers to a healthy control plane showing all the Loom pods that make up a Loom Control Plane.</p>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="_images/healthy_cp.png"><img alt="healthycp" src="_images/healthy_cp.png" style="width: 858.0px; height: 668.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Loom Control Plane - all pods are healthy in this figure.</span></p>
</div>
<p>The figure below refers to a healthy data plane showing all the Loom pods that make up a Loom Data Plane.</p>
<div class="figure align-center" id="id6">
<a class="reference internal image-reference" href="_images/healthy_dp.png"><img alt="healthydp" src="_images/healthy_dp.png" style="width: 757.0px; height: 414.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Loom Data Plane - all pods are healthy in this figure.</span></p>
</div>
</div>
<div class="section" id="where-to-look-for-more-details-is-a-pod-is-not-healthy">
<h4>Where to look for more details is a Pod is not healthy?<a class="headerlink" href="#where-to-look-for-more-details-is-a-pod-is-not-healthy" title="Permalink to this headline">¶</a></h4>
<p>If a pod looks like it is not running properly the next step is to look at it’s log file using the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">podname</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">platform</span>
</pre></div>
</div>
<p>Figure below shows the command and its output.</p>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="_images/pod_log.png"><img alt="podlog" src="_images/pod_log.png" style="width: 1118.0px; height: 206.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Examine Pod Log for details</span></p>
</div>
</div>
<div class="section" id="how-to-determine-which-software-version-is-deployed-for-each-pod">
<h4>How to determine which software version is deployed for each pod?<a class="headerlink" href="#how-to-determine-which-software-version-is-deployed-for-each-pod" title="Permalink to this headline">¶</a></h4>
<p>If you want to check the version of a particular pod, use the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">ls</span>
</pre></div>
</div>
<p>The figure below shows all services are at version B-2017122115 - apart from Airflow which has been patched to version B-2017122123.</p>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="_images/helm_ls.png"><img alt="srvversion" src="_images/helm_ls.png" style="width: 1775.0px; height: 845.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Examine Service version number deployed in pod</span></p>
</div>
</div>
<div class="section" id="looking-for-dependency-health">
<h4>Looking for Dependency Health<a class="headerlink" href="#looking-for-dependency-health" title="Permalink to this headline">¶</a></h4>
<p>If services that rely upon Postgres (Airflow, App Manager, KMS, Cluster Manager, IDM, Job Management) are failing it might be caused by a problem with the Postgres deployment on the persistent VM. Check to see if the databases are present by ssh’ing into the persistent VM and using psql to list the databases hosted on the server. The output should look similar to the following:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/dep_check.png"><img alt="depcheck" src="_images/dep_check.png" style="width: 828.0px; height: 672.0px;" /></a>
</div>
<p>Figure: Examine Service Dependency for failures</p>
</div>
<div class="section" id="loom-tenant-creation-issues">
<h4>Loom Tenant Creation Issues<a class="headerlink" href="#loom-tenant-creation-issues" title="Permalink to this headline">¶</a></h4>
<p>If you find that tenants are not being created properly (i.e. they never reach a state of ‘Active’ in the UI), the first thing to check is whether the create_tenant dag has been triggered. Use port forwarding to map a local port (e.g. 8080) to port 8080 on the Airflow pod and use a web browser to view the Airflow UI using <a class="reference external" href="http://localhost:8080">http://localhost:8080</a>. For e.g., use the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">port</span><span class="o">-</span><span class="n">forward</span> <span class="n">pform</span><span class="o">-</span><span class="n">airflow</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="mi">2073380254</span><span class="o">-</span><span class="n">bgff7</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">n</span> <span class="n">platform</span>
</pre></div>
</div>
<p>In the example below we can see that although Airflow indicates a data plane DAG run has taken place twice (one failed, one succeeded) no executions are listed against add_tenant. So we know that the add tenant request never reached Airflow:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/airflow_eg.png"><img alt="afcheck" src="_images/airflow_eg.png" style="width: 903.0px; height: 453.0px;" /></a>
</div>
<p>Figure: Examine Add Tenant DAG Execution Status</p>
<p>If a DAG run for create_tenant has taken place then the log files for this may indicate a problem.
In this situation we know that a DAG run has not taken place. So the next step is to check the logs for cluster manager. Use the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">cluster</span> <span class="n">manager</span> <span class="n">pod</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">platform</span>
</pre></div>
</div>
<p>In the figure below, notice the “CONTROL_CLUSTER_NOT_FOUND” error. That needs further debugging on what went wrong with the cluster.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/error_cls.png"><img alt="cls_error" src="_images/error_cls.png" style="width: 1269.0px; height: 641.0px;" /></a>
</div>
<p>Figure: Tenant could not be created as there was cluster error</p>
</div>
<div class="section" id="content-source-added-but-cannot-view-data-in-the-loom-application-dashboard">
<h4>Content source added but cannot view data in the Loom Application Dashboard<a class="headerlink" href="#content-source-added-but-cannot-view-data-in-the-loom-application-dashboard" title="Permalink to this headline">¶</a></h4>
<p>If you have added a content source and are not seeing data in the visibility app you might want to check to see if jobs have been created in the database. To do this log in to the persistent VM via ssh (see above) and access Postgres setting the context to the JobsDB. In the select command below, substitute the tenantId with the tenantId of the tenant you are trouble-shooting:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ psql -d JobsDB -U CFUser
JobsDB=&gt; select * from &quot;JobsQueue&quot; where &quot;TenantId&quot;=&#39;3337b7fa-342f-4522-b62b-e4c36b1856cf&#39;;
</pre></div>
</div>
<p>You should see jobs of type DISCOVERY, SCAN and UPLOAD created for your tenant with statuses of CREATED, RUNNING or SUCCEEDED. There maybe multiple entries for each depending on the content source - e.g. for Box, a set of jobs will be created for each account that has access to the data.</p>
</div>
<div class="section" id="kafka-does-not-produce-or-consume-any-data-how-to-fix-it">
<h4>Kafka does not produce or consume any data, how to fix it?<a class="headerlink" href="#kafka-does-not-produce-or-consume-any-data-how-to-fix-it" title="Permalink to this headline">¶</a></h4>
<p>On one of the recent builds we have seen an issue that after initial bootstrap Kafka may not be producing and consuming any data. This seems to be a timing issue during bootstrap. We do not have any specific logs or errors being thrown from Kafka server. Workaround for this issue would be running following 3 commands and wait until pods come up properly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ kubectl -n platform delete pod pform-data-streaming-kafka-stfl-0
$ kubectl -n platform delete pod pform-data-streaming-kafka-stfl-1-0
$ kubectl -n platform delete pod pform-data-streaming-kafka-stfl-2-0
</pre></div>
</div>
<p>This will delete the pods only - not the deployment or service configuration.</p>
<p>Check that the pods start properly by using the get pods command (they will go through the normal cycle of ContainerCreating to Running).
After the pods have started log into Kafka on two different terminal sessions and then produce and consume data by using the following commands (remember to substitute the pod name with the one from your environment):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ kubectl -n platform exec  -it pform-data-streaming-kafka-stfl-0 sh

Producer:

sh-4.2# kafka-console-producer.sh --broker-list pform-data-streaming-kafka-service:9093 --topic INFRASTRUCTURE_DISCOVERY
&lt;Type Anything on the console and wait for 30 seconds. Than press ctrl+c &gt;

Consumer:

sh-4.2# kafka-console-consumer.sh --bootstrap-server pform-data-streaming-kafka-service:9093 --topic INFRASTRUCTURE_DISCOVERY --from-beginning
</pre></div>
</div>
<p>You should see the characters you typed into the producer session appearing in the consumer session. If you don’t then this would suggest there is still a configuration issue with Kafka.</p>
</div>
</div>
<div class="section" id="loom-service-patching">
<h3><a class="toc-backref" href="#id48">Loom Service Patching</a><a class="headerlink" href="#loom-service-patching" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Quick patching Service for troubleshooting</p>
<p>Most of the Loom Services Docker images provide run command which start the service as part of container initialization process. The service starts with pid 1, and it becomes difficult to restart the service without bringing down the container (i.e., service pod).</p>
<p>During troubleshooting you may require to make some quick changes (log message, variable change or fix) and test it before committing the changes. The typical workflow in this case involves rebuilding the Docker image for the service and redeploying it again in Kubernetes. In an ideal deployment, as part of the run command of Docker image, we should install a package (dpkg) in the container. This makes it easy to restart the service without bringing down the container.</p>
<p>Following method can be used so save some time during troubleshooting of Loom Services and applying service patches. In short, what you need to do is use “Sleep infinity” as a Docker RUN command, which would start the container with root process (pid 1) in sleep.  This makes it easy to replace any jar /config information in this container.</p>
<blockquote>
<div><ul>
<li><p class="first">From your service directory edit the Dockerfile and change the run command to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sleep</span> <span class="n">infinity</span>
</pre></div>
</div>
<p>For e.g.,</p>
<blockquote>
<div><p>CMD [“sleep”,”infinity”]</p>
</div></blockquote>
</li>
<li><p class="first">Get the list of pods using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">ls</span>
</pre></div>
</div>
</li>
<li><p class="first">Delete the service you wish to troubleshoot using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">delete</span> <span class="o">--</span><span class="n">purge</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Build the Docker image of the service using the edited Dockerfile (step 1) with different tag using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>   docker build –t &lt;service-name&gt;:&lt;tag&gt;

For e.g.,

   docker build –t apps-classification-orchestrator:test
</pre></div>
</div>
</li>
<li><p class="first">Login into the repository you want to push the image to using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">login</span> <span class="o">&lt;</span> <span class="n">repository</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>

<span class="n">For</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span>

    <span class="n">docker</span> <span class="n">login</span> <span class="n">mcdmpdemoregistry</span><span class="o">.</span><span class="n">azurecr</span><span class="o">.</span><span class="n">io</span> <span class="o">-</span><span class="n">u</span> <span class="n">test</span> <span class="o">-</span><span class="n">p</span> <span class="n">test</span>
</pre></div>
</div>
</li>
<li><p class="first">Tag the image with repository name using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">tag</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">repository</span><span class="o">&gt;/&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>

<span class="n">For</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span>

    <span class="n">docker</span> <span class="n">tag</span> <span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span><span class="p">:</span><span class="n">test</span>  <span class="n">mcdmpdemoregistry</span><span class="o">.</span><span class="n">azurecr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</li>
<li><p class="first">Push the image to repository using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">docker</span> <span class="n">push</span> <span class="o">&lt;</span> <span class="n">repository</span> <span class="o">&gt;/&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>

<span class="n">For</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span>

    <span class="n">docker</span> <span class="n">push</span>  <span class="n">mcdmpdemoregistry</span><span class="o">.</span><span class="n">azurecr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span><span class="p">:</span><span class="n">test</span>
</pre></div>
</div>
</li>
<li><p class="first">From deployment/helm folder run the following commands to deploy the service:</p>
<blockquote>
<div><ul>
<li><p class="first">Verify correct repository and tag are applied in deployment.yaml using the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>  <span class="n">helm</span> <span class="n">install</span> <span class="o">--</span><span class="n">debug</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">repository</span><span class="o">=&lt;</span><span class="n">repository</span><span class="o">&gt;/</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">tag</span><span class="o">=&lt;</span><span class="n">tag</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/</span>

<span class="n">For</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span>

  <span class="n">helm</span> <span class="n">install</span> <span class="o">--</span><span class="n">debug</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">repository</span><span class="o">=</span><span class="n">mcdmpdemoregistry</span><span class="o">.</span><span class="n">azurecr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">tag</span><span class="o">=</span><span class="n">test</span> <span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Install the service using command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>  <span class="n">helm</span> <span class="n">install</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=&lt;</span><span class="n">namespace</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">repository</span><span class="o">=&lt;</span><span class="n">repository</span><span class="o">&gt;/</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">tag</span><span class="o">=&lt;</span><span class="n">tag</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="n">For</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span>

  <span class="n">helm</span> <span class="n">install</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">platform</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">repository</span><span class="o">=</span><span class="n">mcdmpdemoregistry</span><span class="o">.</span><span class="n">azurecr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span> <span class="o">--</span><span class="nb">set</span> <span class="n">image</span><span class="o">.</span><span class="n">tag</span><span class="o">=</span><span class="n">test</span> <span class="n">apps</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">orchestrator</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Pod is up and running with infinite sleep. You can exec into pod and execute the jar, script, etc., within it. Also new jars, files, scripts, etc., can be copied into the pod.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Patch for terminal Dimensions not supported inside Pods</p>
<p>Many a times, when accessing a Pod say Kafka or Loom Connector Service, the pod doesn’t use the entire terminal dimension. The text gets wrapped around or overlapped or only few lines are shown while editing a file inside pod using vi editor.</p>
<p>The following script can be used to get rid of the problem for that instance.</p>
<ul>
<li><p class="first">In your machine, create a file, say file with the name exec_script.sh</p>
</li>
<li><p class="first">Update the file with the following commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>if [ &quot;$1&quot; = &quot;&quot; ]; then
  echo &quot;Usage: bash exec_script.sh &lt;pod_name&gt;&quot;
  exit 1
fi

COLUMNS=`tput cols`
LINES=`tput lines`
TERM=xterm
kubectl --namespace=platform exec -i -t $1 env COLUMNS=$COLUMNS LINES=$LINES TERM=$TERM bash
</pre></div>
</div>
</li>
<li><p class="first">To get inside the pod instead of using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">platform</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">pod_name</span><span class="o">&gt;</span> <span class="n">bash</span>
</pre></div>
</div>
<p>use the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">exec_script</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="n">pod_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="troubleshooting-loom-networking-issues">
<h3><a class="toc-backref" href="#id49">Troubleshooting Loom networking issues</a><a class="headerlink" href="#troubleshooting-loom-networking-issues" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="control-plane-issues">
<h3><a class="toc-backref" href="#id50">Control plane Issues</a><a class="headerlink" href="#control-plane-issues" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="data-plane-issues">
<h3><a class="toc-backref" href="#id51">Data plane Issues</a><a class="headerlink" href="#data-plane-issues" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="message-flow-between-data-plane-control-plane">
<h3><a class="toc-backref" href="#id52">Message flow between data plane/control plane</a><a class="headerlink" href="#message-flow-between-data-plane-control-plane" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="tenant-deployment-issues">
<h3><a class="toc-backref" href="#id53">Tenant deployment issues</a><a class="headerlink" href="#tenant-deployment-issues" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="security-issues">
<h3><a class="toc-backref" href="#id54">Security Issues</a><a class="headerlink" href="#security-issues" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="issues-related-to-loom-logs-access-logs">
<h3><a class="toc-backref" href="#id55">Issues related to Loom logs, Access logs</a><a class="headerlink" href="#issues-related-to-loom-logs-access-logs" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="moving-to-different-availability-set">
<h3><a class="toc-backref" href="#id56">Moving to different availability set</a><a class="headerlink" href="#moving-to-different-availability-set" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="issues-related-to-sluggish-loom-application-response">
<h3><a class="toc-backref" href="#id57">Issues related to sluggish Loom Application response</a><a class="headerlink" href="#issues-related-to-sluggish-loom-application-response" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="issues-related-to-loom-metrics">
<h3><a class="toc-backref" href="#id58">Issues related to Loom Metrics</a><a class="headerlink" href="#issues-related-to-loom-metrics" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="issues-related-to-system-load">
<h3><a class="toc-backref" href="#id59">Issues related to System Load</a><a class="headerlink" href="#issues-related-to-system-load" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="deployment-faq">
<h2><a class="toc-backref" href="#id45">Deployment FAQ</a><a class="headerlink" href="#deployment-faq" title="Permalink to this headline">¶</a></h2>
<p>This is a FAQ document template which will cover generic Q/A related to Loom deployment.  Note this will cover all deployment issues which are not specific to a particular deployment model.</p>
<div class="section" id="question-a-related-to-any-type-of-loom-deployment">
<h3><a class="toc-backref" href="#id46">Question A: Related to any type of Loom deployment</a><a class="headerlink" href="#question-a-related-to-any-type-of-loom-deployment" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="loom_trbs_faq.html" class="btn btn-neutral float-right" title="Loom How-To, FAQ and Troubleshooting Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to Loom’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Veritas Technologies LLC.
      Last updated on Apr 7, 2018, 11:18:09 PM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <p>
    <ul>
    <a href="../pform-idocs/archive_index.html" style="float:left;">Loom Documentation Archives</a>
    </ul>
    </p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>